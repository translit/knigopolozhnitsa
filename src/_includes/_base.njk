<!DOCTYPE html>
<html lang="cu" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <meta name="robots" content="noindex, nofollow">
    <title>{{ navigation.title if navigation.title else title | safe }}</title>
    <link rel="stylesheet" href="/assets/css/style.css">
    <meta name="color-scheme" content="light dark">
    <!-- Favicon -->
    <link rel="icon" href="/assets/images/favicon.ico">
    <link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png">
    <!-- Add preload hints for navigation -->
    {% if navigation.key and layout != "single-work.njk" %}
    {% set chapterNav = collections.all | getChapterNavigation(navigation.key) %}
    {% if chapterNav and chapterNav.next %}
    <link rel="prefetch" href="{{ chapterNav.next.url }}">
    {% endif %}
    {% endif %}
</head>
<body class="{{ bodyClass }}">
    <main>
        <!-- Breadcrumbs -->
        {% if navigation.key and navigation.key != "library" %}
        <nav class="breadcrumb" aria-label="Breadcrumb">
            {% for crumb in collections.all | customBreadcrumbs(navigation.key) %}
                {% if not loop.first %} › {% endif %}
                {% if loop.last %}
                    <span aria-current="page">{{ crumb.data.navigation.title | safe }}</span>
                {% else %}
                    <a href="{{ crumb.url }}">{{ crumb.data.navigation.title | safe }}</a>
                {% endif %}
            {% endfor %}
        </nav>
        {% endif %}

        {% block content %}{% endblock %}

        <!-- Bottom Navigation -->
        {% if navigation.key %}

        <!-- Single works: only show breadcrumbs -->
        {% if layout == "single-work.njk" %}
        <nav class="toc-navigation" aria-label="Navigation">
            <nav class="nav-breadcrumb" aria-label="Navigation Breadcrumb">
                {% for crumb in collections.all | customBreadcrumbs(navigation.key) %}
                    {% if not loop.first %} › {% endif %}
                    {% if loop.last %}
                        <span aria-current="page">{{ crumb.data.navigation.title | safe }}</span>
                    {% else %}
                        <a href="{{ crumb.url }}">{{ crumb.data.navigation.title | safe }}</a>
                    {% endif %}
                {% endfor %}
            </nav>
        </nav>

        <!-- Multi-chapter works: show full navigation -->
        {% else %}

        <!-- Chapter Navigation (for chapter pages with type and parent) -->
        {% if type and navigation.parent %}
        {% set chapterNav = collections.all | getChapterNavigation(navigation.key) %}
        {% if chapterNav %}
        <nav class="chapter-navigation" aria-label="Chapter Navigation">
            <!-- Breadcrumbs -->
            <nav class="nav-breadcrumb" aria-label="Navigation Breadcrumb">
                {% for crumb in collections.all | customBreadcrumbs(navigation.key) %}
                    {% if not loop.first %} › {% endif %}
                    {% if loop.last %}
                        <span aria-current="page">{{ crumb.data.navigation.title | safe }}</span>
                    {% else %}
                        <a href="{{ crumb.url }}">{{ crumb.data.navigation.title | safe }}</a>
                    {% endif %}
                {% endfor %}
            </nav>

            <!-- Navigation Buttons -->
            <div class="nav-grid">
                {% if chapterNav.previous %}
                <a href="{{ chapterNav.previous.url }}" class="nav-button nav-prev" rel="prev" aria-label="Go to previous chapter">
                    ‹
                </a>
                {% else %}
                <div class="nav-button nav-disabled">
                    ‹
                </div>
                {% endif %}

                {% if chapterNav.next %}
                <a href="{{ chapterNav.next.url }}" class="nav-button nav-next" rel="next" aria-label="Go to next chapter">
                    ›
                </a>
                {% else %}
                <div class="nav-button nav-disabled">
                    ›
                </div>
                {% endif %}
            </div>
        </nav>
        {% endif %}

        <!-- TOC Navigation (for work/TOC pages without type but with navigation.key) -->
        {% elif not type and navigation.parent %}
        <nav class="toc-navigation" aria-label="TOC Navigation">
            <!-- Breadcrumbs for TOC pages -->
            <nav class="nav-breadcrumb" aria-label="Navigation Breadcrumb">
                {% for crumb in collections.all | customBreadcrumbs(navigation.key) %}
                    {% if not loop.first %} › {% endif %}
                    {% if loop.last %}
                        <span aria-current="page">{{ crumb.data.navigation.title | safe }}</span>
                    {% else %}
                        <a href="{{ crumb.url }}">{{ crumb.data.navigation.title | safe }}</a>
                    {% endif %}
                {% endfor %}
            </nav>
        </nav>
        {% endif %}

        {% endif %}
        {% endif %}
    </main>

    <!-- JavaScript for navigation -->
    <script src="/assets/js/navigation.js"></script>
</body>
</html>
